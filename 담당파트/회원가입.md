
> ## 세미프로젝트 담당 파트 정리 2

<br/>

<img width="" src="https://user-images.githubusercontent.com/75427390/146753413-68cd4a89-d47b-491a-87a6-be769d0c84a8.png"/>

<br/>

1. 아이디 중복 확인
2. 이메일 인증
3. 도로명 주소(API)
4. 유효성 검사
5. 회원가입

<br/>

회원가입 페이지에 구현한 기능들을 위의 순서대로 코드를 정리했습니다.

<br/>
<br/>

> ### 1. 아이디 중복 확인

<br/>

**login_signup.jsp**
```jsp
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    // 아이디 중복확인 버튼을 눌렀을 때 수행되는 함수
	function idCheck(){
		
		var id = document.getElementsByName("member_id")[0]; // 사용자 입력값
		
        var idpwExp = /^[a-zA-Z0-9]{6,20}$/; // 영문 대소문자, 숫자로 구성된 길이 6-20자리 사이 문자열

        // 유효성 검사
        // 공백 또는 값이 없을 때 alert창
		if (id.value.trim() == "" || id.value == null){
			alert("아이디를 입력해 주세요.");

		} else if(!idpwExp.test(id.value)) { // 정규식 test() - 찾는 문자열이 들어있는지 아닌지를 알려준다.
			alert("아이디는 6~20자의 영문 대소문자와 숫자로만 입력해 주세요.");

		} else {
			// ajax 비동기 통신
			$.ajax({
				type : "POST",
				url : "../login.do?command=login_idchk&member_id="+encodeURIComponent(id.value),
				dataType : "json",
				success : function(data){
					var res = JSON.stringify(data.idnotused);
					if (res=="true"){
						alert("생성 가능한 아이디입니다.");
                        // title="y"로 변경
						document.getElementsByName("member_id")[0].title = "y"; 
						document.getElementsByName("member_pw")[0].focus();

					} else {
						alert("중복된 아이디가 존재합니다.");
						document.getElementsByName("member_id")[0].focus();

					}
				},
				error : function(){
					alert("error");
				}
			});
		}
	}


    /* onkeyup 이벤트 발생 시 수행되는 함수
       회원가입 페이지에서는 title 태그를 체크 확인용으로 사용했다.
       n : 체크되지 않음, y : 체크됨
       사용자가 아이디 중복체크를 한 후(y로 변경) 아이디를 변경하게 되면 title을 n으로 바꾸어 다시 중복체크를 받도록 했다.
    */
    function idCheckInit(form) {
		var n1 = document.getElementsByName("member_id")[0].title;
		if(n1 =="y") {
			$("#member_Id").attr("title","n");
		}
	}
</script>

<div>
	<input type="text" name="member_id" id="member_Id" maxlength="20" placeholder="아이디" title="n" required="required" onkeyup="idCheckInit(join);" />
	<input type="button" value="중복 확인" onclick="idCheck();"/>
</div>
```

<br/>
<br/>

**login_servlet.java**
```java
if("login_idchk".equals(command)) {
	String member_id = request.getParameter("member_id");
	// dto = MemberDto
    dto = dao.SignUpIdChk(member_id);
	boolean idnotused = true;
	if (dto != null) {
        // db에 중복 아이디가 있으면 false로
		idnotused = false;
	}
    HashMap<String, Object> hashMap = new HashMap<String, Object>();
    hashMap.put("idnotused", idnotused);
    JSONObject obj = new JSONObject(hashMap);
            
    response.getWriter().print(obj);
}
```

<br/>
<br/>

**PetDaoImpl.java**
```java
// String namespace = "com.pet.ft.mapper.";
@Override
public MemberDto SignUpIdChk(String member_id) {
	MemberDto dto = null;
	try(SqlSession session = getSqlSessionFactory().openSession(true)){
		dto = session.selectOne(namespace+"SignUpIdChk", member_id);
	}
	return dto;
}
```

<br/>
<br/>

**pet-mapper.xml**
```xml
<select id="SignUpIdChk" resultType="MemberDto" parameterType="String">
  		SELECT MEMBER_ID FROM MEMBER
  		WHERE MEMBER_ID = #{member_id}
</select>
```

<br/>
<br/>

> ### 2. 이메일 인증

<br/>

**login_signup.jsp**
```jsp
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    // 이메일 발송
	function emailCheck(){
		
		var email = document.getElementsByName("member_email")[0];
		var emailExp = /^[A-Za-z0-9_.]+[A-Za-z0-9]*[@]{1}[A-Za-z0-9]+[A-Za-z0-9]*[.]{1}[A-Za-z]{1,3}$/;

        // 유효성 체크
		if (email.value.trim() == "" || email.value == null){
			alert("이메일을 입력해 주세요.");
		} else if(!emailExp.test(email.value)) {
			alert("이메일 형식이 올바르지 않습니다.");
		} else {
			$.ajax({
				type : "POST",
				url : "../login.do?command=login_emailchk&member_email="+encodeURIComponent(email.value),
				dataType : "json",
				success : function(result){
					var res = JSON.stringify(result.emailnotused);
					if (res=="true"){
						alert("인증 메일이 발송되었습니다. \n메일함 ( " + email.value + " ) 확인 후 인증 번호를 입력해 주세요.");
						document.getElementsByName("member_email")[0].title = "y";
					} else {
						alert(email.value + " 은 이미 가입된 이메일입니다. \n다른 이메일을 입력해 주세요.");
						document.getElementsByName("member_email")[0].focus();
					}
				},
				error : function(){
					alert("error");
				}
			});
		}
	}
	
    // 인증번호 확인
	function emailauthCheck(){
		var email = document.getElementsByName("member_email")[0];
		var emailauth = document.getElementsByName("member_email_auth")[0];

		if (emailauth.value.trim() == "" || emailauth.value == null){
			alert("인증번호를 입력해 주세요.");
		} else if(email.title == "n") {
			alert("이메일 인증을 버튼을 먼저 눌러주세요.");
		} else {
			$.ajax({
				type : "POST",
				url : "../login.do?command=login_emailAuth&member_email_auth="+encodeURIComponent(emailauth.value),
				dataType : "json",
				success : function(result){
					var res = JSON.stringify(result.result);
					if (res=="true"){
						alert("인증이 완료되었습니다. \n회원가입을 계속 진행해 주세요.");
						document.getElementsByName("member_email_auth")[0].title = "y";
					} else {
						alert("인증번호가 일치하지 않습니다. 인증번호를 확인해 주세요.");
					}
				}
			});
		}
	}
	
    // 이메일 변경 시 인증 초기화
	function emailCheckInit(form) {
		var n2 = document.getElementsByName("member_email")[0].title;
		if(n2=="y") {
			$("#member_email").attr("title","n");
		}
	}
	
    // 인증번호 수정 시 인증 초기화
	function emailauthCheckInit(form) {
		var n3 = document.getElementsByName("member_email_auth")[0].title;
		if(n3=="y") {
			$("#member_email_auth").attr("title","n");
		}
	}
	
</script>

<div>
	<input type="text" name="member_email"  id="member_email" placeholder="  이메일" title="n" required="required" onclick="idCheckConfirm();" onkeyup="emailCheckInit(join);"/>
	<input type="button" value=" 이메일 인증 " onclick="emailCheck();"/>
</div>
<div>
	<input type="text" name="member_email_auth" id="member_email_auth" placeholder="  인증번호를 입력하세요." title="n" required="required" onclick="idCheckConfirm();" onkeyup="emailauthCheckInit(join);"/>
	<input type="button" value=" 인증 확인 " onclick="emailauthCheck();" />
</div>
```

